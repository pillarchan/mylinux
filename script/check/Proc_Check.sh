Proc=$(ps -ef |awk 'NR>1{for (i=8;i<=NF;i++)printf("%s ", $i);print "","\n运行用户: "$1,"\nPPID: "$2,"\nPID: "$3}'| egrep -v "php-fpm: pool www|nginx: worker process|/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock|/usr/local/php-fpm-exporter/php-fpm-exporter --fastcgi=unix:/tmp/php-cgi.sock --addr=0.0.0.0:9253|/usr/local/bin/containerd-shim-runc-v2|nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf|php-fpm: master process|kworker/|\[nfsd\]|/usr/bin/stunnel /etc/stunnel/redis-cli.conf|/usr/share/filebeat/bin/filebeat|awk NR>|/usr/lib/systemd/systemd-journald|/usr/sbin/rpc.statd|/sbin/rpcbind -w|/usr/lib/systemd/systemd-logind|/usr/sbin/rpc.mountd|/usr/sbin/rpc.idmapd|/usr/sbin/lvmetad -f|/usr/local/node_exporter/node_exporter|/usr/sbin/gssproxy -D|/sbin/agetty --noclear tty1 linux|/usr/sbin/crond -n|/sbin/agetty --keep-baud 115200,38400,9600 ttyS0 vt220|/usr/sbin/rsyslogd -n|/usr/sbin/sshd -D|/usr/local/bin/containerd|/usr/bin/telegraf -config|/usr/bin/python2 -Es /usr/sbin/tuned -l -P|/sbin/dhclient -1 -q -lf|/usr/sbin/chronyd|/usr/bin/dbus-daemon --system|/usr/lib/polkit-1/polkitd|/sbin/auditd|/usr/sbin/irqbalance --foreground|\[lockd\]|\[nfsd4_callbacks\]|/usr/lib/systemd/systemd-udevd|\[xprtiod\]|\[rpciod\]|\[nfit\]|\[xfs|\[bioset\]|\[ena\]|\[nvme-|\[watchdog|\[ksoftirqd/|\[migration|\[kaluad\]|\[kblockd\]|\[kthreadd\]|/usr/lib/systemd/systemd --switched-root|sshd: super_user|\[rcu_bh\]|\[rcu_sched\]|\[lru-add-drain\]|\[kdevtmpfs\]|\[netns\]|\[khungtaskd\]|\[writeback\]|\[kintegrityd\]|\[md\]|\[edac-poller\]|\[kswapd0\]|\[ksmd\]|\[khugepaged\]|File_Check.sh|sshd: root@pts|\[crypto\]|\[kthrotld\]|\[kmpath_rdacd\]|\[kpsmoused\]|\[ipv6_addrconf\]|\[deferwq\]|\[kauditd\]|AnsiballZ_setup.py|Foreign_Address_Check.sh|sshd: root@|tail -f /home/wwwroot/think|ps -ef|egrep|sudo -i|sort|uniq|bash /start.sh|\-bash|/usr/local/mysql/bin/mysqld_safe|/usr/lib/systemd/systemd --system|Proc_Check.sh|/usr/local/mysql/bin/mysqld|tail -f /home/wwwlogs/access.log|/usr/bin/docker-containerd-shim-current|/usr/bin/docker-containerd-current|/usr/bin/dockerd-current|/usr/lib/systemd/systemd|./nsqClient -t|/nsqlookupd|/nsqd -tcp-address|inet_gethost|/usr/lib64/erlang/erts-11.2.2/bin/beam.smp|/usr/lib/rabbitmq/bin/rabbitmq-server|/usr/sbin/rabbitmq-server|rabbitmq-server|/usr/lib64/erlang/erts-11.2.2/bin/epmd|/usr/local/bin/redis-server|php think swoole restart|SwooleWorker|swoole server: task process for ThinkPHP|WorkerMan: worker process|/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf|/bin/sh /usr/bin/mysqld_safe|/usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql|SwooleService: master process|erl_child_setup|tail -f /etc/passwd|/usr/bin/rsync --daemon --no-detach|/redis_exporter|swoole_http_server|tail -f /usr/local/php/etc/php.ini|swoole server|WorkerMan|tail -f /home/wwwroot/404.html|/usr/local/hostguard/bin/hostguard|/sbin/dhclient|/usr/sbin/atd|/CloudResetPwdUpdateAgent/depend/jre/bin/java|/CloudResetPwdUpdateAgent/bin|/usr/local/uniagent/bin/uniagent|/usr/sbin/NetworkManager|\[scsi_|\[ata_sff\]|\[ttm_swap\]|\[jbd2/vda1-8\]|\[ext4-rsv-conver\]|/nsqadmin|sshd: sys_user|/usr/bin/docker-current exec|/usr/libexec/docker/docker-runc-current|/usr/sbin/CROND|/bin/java -jar /home/pools/lottery.bonus.pools-1.0-SNAPSHOT.jar|php ./lottery/think consumdailymq loop|CenterServer|grabsCanadaKeno|AgentServer|php /home/wwwroot/think transfer|docker exec group_report_1 sh|rebuild_per2min_v2_17.sh|sleep|php /home/wwwroot/public/index.php|/home/wwwroot/script/refresh_cache_per3min.sh|php /home/wwwroot/think statistic refresh_cache minutes|php think allwinCount|php /home/wwwroot/think|refresh_cache_per3min.sh|/usr/sbin/ntpdate|php index2.php /Cli/Third/trans_money|arping|/run/containerd/io.containerd.runtime.v2.task|/usr/bin/python2 -Es /usr/sbin/tuned|/usr/sbin/anacron|ip-api.com|/usr/sbin/logrotate|grep -E -o|jq|AnsiballZ_yum.py|AnsiballZ_command.py|Blevel1_agent|statistics|xargs|Actionchsh.php|pro_rebuild_all_0400-3.sh|pro_rebuild_all_0400-2.sh|recommend_month|count_games_achievement_month|php /home/wwwroot/quartz/lottery/think|Recharge.php|trilateral_count_by_admin|pro_rebuild_all_0400-1.sh|trans_money|runc init|sshd: om_user|Accepted|docker-current|docker-runc-cur|docker-containe|pro_service6_0530.sh|user_daily_others|user_daily_level_count|user_daily_recharge|user_daily_je_games|check_risk_daily.sh|bot5240878837|pro_rebuild_all_0005.sh|refresh_cache_perday|661168875|sshd: root|app.log|accepted|docker exec|access.log|sshd: \[net\]|\[php\]|php-ps|\[sh\]|reportUserDailyData|rebuild_per2min_v2_17_21_10.sh|sftp-server|yesterdayData|refresh_cache|\[bash\]|\[docker\]|\[grep\]|/proc/self/exe|\[ssh\]|updateJeGameRecordAllBill|consumreportdailymq|rkhunter|Victory.php|Cashout.php|\[crond\]|Todayagent.php|robot_level_count|allwinCount|\[php-fpm\]|\[uri_301.sh\]|\[python\]|/usr/bin/python|unit_test|robot_daily_count|consumreportplatformmq|\[kswapd1\]|/usr/bin/rhsmcertd|pro_rebuild_rebate_0800"|awk '$1!~/^bash$/&&$1!~"^/bin/bash$"&&$1!~"^/bin/sh$"{print $0}' | grep -v awk)

send_TG() {
MSG="::进程检测:: 
<pre>主机名: $1
$Proc</pre>"
curl -X POST --data chat_id="-860156869" --data-urlencode "text=${MSG}" "https://api.telegram.org/bot5240878837:AAFq-JRxvsAgfAh7bQg7Zkm7bVYsgyI4dF4/sendMessage?parse_mode=HTML"
}
if [ ${#Proc} -gt 0 ]
then
    send_TG $(hostname)
fi
